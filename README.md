# Kindle PDF変換ツール

macOSのKindleアプリからスクリーンショットを自動撮影してPDFに変換するツールです。

## 必要環境

- macOS
- Python 3.9以上
- Amazon Kindleアプリ
- cliclick（`brew install cliclick`）

## セットアップ

```bash
# 依存パッケージのインストール
pip install -r requirements.txt

# cliclickのインストール（必要な場合）
brew install cliclick
```

## アクセシビリティ権限

このツールはキーボード操作の自動化を行うため、アクセシビリティ権限が必要です。

1. システム設定 > プライバシーとセキュリティ > アクセシビリティ
2. ターミナル（または使用しているターミナルアプリ）を許可

## 使い方

### テストモード（推奨：最初に実行）

5ページのみ撮影して動作確認します。

```bash
python kindle_to_pdf.py --test
```

### 単一書籍（手動）

Kindleで書籍を開いた状態で実行：

```bash
python kindle_to_pdf.py -n "書籍名"
```

### 単一書籍（自動）

書籍を自動で検索・オープンして変換：

```bash
python kindle_to_pdf.py -n "書籍名" --auto
```

### 複数書籍（自動連続処理）

```bash
python kindle_to_pdf.py --books "書籍1" "書籍2" "書籍3"
```

## オプション

| オプション | 説明 | デフォルト |
|-----------|------|-----------|
| `-n`, `--name` | 書籍名 | kindle_book |
| `-w`, `--wait` | ページめくり間隔（秒） | 0.8 |
| `-m`, `--max-pages` | 最大ページ数 | 2000 |
| `--auto` | 自動で書籍を検索・オープン | - |
| `--books` | 複数書籍を連続処理 | - |
| `--test` | テストモード（5ページのみ） | - |

## 停止方法

`Ctrl+C` でいつでも中断できます。

## 仕組み

1. Kindleウィンドウの位置・サイズを取得
2. スクリーンショットを撮影
3. 右矢印キーでページをめくる
4. 画像ハッシュで重複検出（最終ページ判定）
5. 画像のトリミング・最適化
6. PDFに結合

## トラブルシューティング

### ページがめくれない

- アクセシビリティ権限を確認してください
- Kindleウィンドウが最前面にあることを確認してください

### ウィンドウが見つからない

- Kindleアプリで書籍を開いた状態で実行してください
- `--test` モードで動作確認してください

## ライセンス

MIT License
